import numpy as np  # Импорт библиотеки для математических вычислений
from scipy import stats  # Импорт модуля для статистических тестов

# Данные - исходные значения y
y = np.array([1.7, -5.4, -4.0, -5.9, -1.6, 0.0, 0.6, 2.1, 0.1, -4.9,
              -3.5, 5.9, 8.5, 9.9, 13.3, 11.1, 14.4, 16.2])
# Создание массива x как последовательности индексов от 0 до 17
x = np.arange(len(y))

"""
np.polyfit(x, y, degree) - находит коэффициенты полинома, который минимизирует сумму квадратов отклонений
np.polyval(coefficients, x) - вычисляет значения полинома в точках x
residuals - разности между фактическими и предсказанными значениями
stats.shapiro(residuals) - тест на нормальность распределения остатков
p_value - вероятность того, что остатки распределены нормально (при p > 0.05 принимаем гипотезу о нормальности)

"""
# Аппроксимация полиномом 4-го порядка
degree = 4  # Задание степени полинома
# Нахождение коэффициентов полинома методом наименьших квадратов
coefficients = np.polyfit(x, y, degree)

# Вычисление предсказанных значений y по найденному полиному
y_pred = np.polyval(coefficients, x)

# Вычисление остатков (разница между реальными и предсказанными значениями)
residuals = y - y_pred

# Проверка нормальности остатков с помощью теста Шапиро-Уилка
# _ - статистика теста (не используется), p_value - значимость
_, p_value = stats.shapiro(residuals)

# Вывод коэффициентов полинома на экран
print("Коэффициенты полинома:")
# Перебор всех коэффициентов полинома
for i, coef in enumerate(coefficients):
    # Вывод коэффициента с указанием степени (от старшей к младшей)
    print(f"  a{len(coefficients)-i-1} = {coef:.4f}")

# Вывод p-значения теста на нормальность
print(f"P-значение: {p_value:.4f}")

# Проверка статистической гипотезы на уровне значимости 5%
if p_value > 0.05:
    # Если p > 0.05, гипотеза о нормальности не отвергается
    print("Гипотеза НЕ отвергается - остатки нормально распределены")
else:
    # Если p ≤ 0.05, гипотеза о нормальности отвергается
    print("Гипотеза ОТВЕРГАЕТСЯ - остатки не нормально распределены")